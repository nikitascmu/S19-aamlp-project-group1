total_rx = sum(RX),
total_acj = sum(ACJ),
total_cr_cases = sum(MDJS_CR_CASES),
total_cr_drug_cases = sum(MDJS_CR_DRUG_CASES))
outcome_df = prog %>% group_by(PERSON_ID) %>%
summarise(od_date = max(OVERDOSE_DATE), od_year = max(OVERDOSE_YEAR),
od_month = max(OVERDOSE_MONTH), od_type = max(OPIATE_OVERDOSE))
summary(presc %>% mutate_if(is.character, as.factor))
age_df = presc %>% group_by(PERSON_ID) %>% summarise(min_age = min(AGE), max_age = max(AGE), mean_age = mean(AGE))
age_df = age_df %>% group_by(PERSON_ID) %>% mutate(age = if_else(min_age<0, max_age, min_age)) %>%
mutate(age = if_else(age<0, 999, age))
age_df$age[which(age_df$age>99)] = NA
summary(age_df)
presc$drug_strength <- str_extract(presc$LABEL_NAME, "[0-9].*")
View(presc)
unique(presc$drug_strength)
# drug strength indicated that these are oral solutions per 5ML, so made this change manually
presc$drug_strength[which(grepl('ORAL SOLUTION', presc_raw$extract_strength))] <- "5-325/5ML"
unique(presc$DRUG_STRENGTH)
presc_raw$DRUG_STRENGTH[which(grepl('NALOXONE', presc_raw$DRUG_STRENGTH))] <- "50MG-0.5MG"
presc[273566,]
#
presc_raw$drug_strength[which(grepl('NALOXONE', presc_raw$LABEL_NAME))] <- "50MG-0.5MG"
#
presc$drug_strength[which(grepl('NALOXONE', presc$LABEL_NAME))] <- "50MG-0.5MG"
unique(presc$drug_strength)
presc$drug_strength[which(is.na(presc$drug_strength))] = presc$DRUG_STRENGTH
#--- Loading helper files
loadlibs = function(libs) {
for(lib in libs) {
class(lib)
if(!do.call(require,as.list(lib))) {install.packages(lib)}
do.call(require,as.list(lib))
}
}
libs = c("tidyr","magrittr","purrr","dplyr","stringr","readr","data.table", "mice",
"randomForest", "ada", "gbm", "caret", "e1071", "ROCR", "ggplot2", "glmnet", "readxl")
loadlibs(libs)
mode_fun <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
#--- setting global decimal print setting
options(scipen=4)
prog = fread("program_activity.csv") %>% as_tibble()
dem = fread("demographic.csv") %>% as_tibble()
presc = fread("opiate_prescription_fills.csv") %>% as_tibble()
summary(dem %>% mutate_if(is.character, as.factor))
# missing data for RACE and GENDER
# merging native hawaiian/pacific islander + no data = no data and other because the former is too small
# merging transgendered male to female and no data = no data and other because former is too small
# dealing with missingness by allowing it to be its own category - because most likely MNAR
dem$RACE[which(grepl("No Data", dem$RACE))] = "No Data and Other"
dem$RACE[which(grepl("Native Hawaiian", dem$RACE))] = "No Data and Other"
dem$GENDER[which(grepl("No Data", dem$GENDER))] = "No Data and Other"
dem$GENDER[which(grepl("Transgendered", dem$GENDER))] = "No Data and Other"
colnames(dem) = c("PERSON_ID", "race", "gender")
summary(dem %>% mutate_if(is.character, as.factor))
summary(prog)
#--- Loading helper files
loadlibs = function(libs) {
for(lib in libs) {
class(lib)
if(!do.call(require,as.list(lib))) {install.packages(lib)}
do.call(require,as.list(lib))
}
}
libs = c("tidyr","magrittr","purrr","dplyr","stringr","readr","data.table", "mice",
"randomForest", "ada", "gbm", "caret", "e1071", "ROCR", "ggplot2", "glmnet", "readxl")
loadlibs(libs)
mode_fun <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
#--- setting global decimal print setting
options(scipen=4)
prog = fread("program_activity.csv") %>% as_tibble()
dem = fread("demographic.csv") %>% as_tibble()
presc = fread("opiate_prescription_fills.csv") %>% as_tibble()
summary(dem %>% mutate_if(is.character, as.factor))
# missing data for RACE and GENDER
# merging native hawaiian/pacific islander + no data = no data and other because the former is too small
# merging transgendered male to female and no data = no data and other because former is too small
# dealing with missingness by allowing it to be its own category - because most likely MNAR
dem$RACE[which(grepl("No Data", dem$RACE))] = "No Data and Other"
dem$RACE[which(grepl("Native Hawaiian", dem$RACE))] = "No Data and Other"
dem$GENDER[which(grepl("No Data", dem$GENDER))] = "No Data and Other"
dem$GENDER[which(grepl("Transgendered", dem$GENDER))] = "No Data and Other"
colnames(dem) = c("PERSON_ID", "race", "gender")
summary(dem %>% mutate_if(is.character, as.factor))
summary(prog)
# No missing values in the program data
# Overdose date and opiate overdose has NAs for individuals who have not overdosed,
# so that is meaningful and not actually missing
prog = prog %>% separate(OVERDOSE_DATE, c("OVERDOSE_YEAR", "OVERDOSE_MONTH"), remove=FALSE, sep=4)
prog$OPIATE_OVERDOSE[which(grepl(0, prog$OPIATE_OVERDOSE))] = "Non-Opiate Overdose"
prog$OPIATE_OVERDOSE[which(grepl(1, prog$OPIATE_OVERDOSE))] = "Opiate Overdose"
prog$OPIATE_OVERDOSE[which(is.na(prog$OPIATE_OVERDOSE))] = "No Overdose"
summary(prog %>% mutate_if(is.character, as.factor))
times_used = prog %>% group_by(PERSON_ID) %>% select(YEAR, MONTH) %>% summarise(times_used = max(sequence(n())))
prog_summary = prog %>% group_by(PERSON_ID) %>% summarise(total_cyfchild = sum(CYFCHILD),
total_cyfparent = sum(CYFPARENT),
total_mh = sum(MH),
total_da = sum(DA),
total_rx = sum(RX),
total_acj = sum(ACJ),
total_cr_cases = sum(MDJS_CR_CASES),
total_cr_drug_cases = sum(MDJS_CR_DRUG_CASES))
outcome_df = prog %>% group_by(PERSON_ID) %>%
summarise(od_date = max(OVERDOSE_DATE), od_year = max(OVERDOSE_YEAR),
od_month = max(OVERDOSE_MONTH), od_type = max(OPIATE_OVERDOSE))
summary(presc %>% mutate_if(is.character, as.factor))
age_df = presc %>% group_by(PERSON_ID) %>% summarise(min_age = min(AGE), max_age = max(AGE), mean_age = mean(AGE))
age_df = age_df %>% group_by(PERSON_ID) %>% mutate(age = if_else(min_age<0, max_age, min_age)) %>%
mutate(age = if_else(age<0, 999, age))
age_df$age[which(age_df$age>99)] = NA
summary(age_df)
presc$drug_strength <- str_extract(presc$LABEL_NAME, "[0-9].*")
# drug strength indicated that these are oral solutions per 5ML, so made this change manually
presc$drug_strength[which(grepl('ORAL SOLUTION', presc_raw$extract_strength))] <- "5-325/5ML"
# drug strength indicated that these are oral solutions per 5ML, so made this change manually
presc$drug_strength[which(grepl('ORAL SOLUTION', presc$extract_strength))] <- "5-325/5ML"
presc$drug_strength[which(grepl('NALOXONE', presc$LABEL_NAME))] <- "50MG-0.5MG"
presc_raw = presc %>% mutate(drug_strength = if_else(is.na(drug_strength), DRUG_STRENGTH, drug_strength))
unique(presc_raw$drug_strength)
rm(presc_raw)
# Creating a new column 'num_strength' that keeps only numeric values from 'drug_strength'
presc$num_strength <- str_extract(presc$drug_strength, "[0-9]*.*[0-9]")
unique(presc$num_strength)
View(presc)
presc = presc %>% mutate(drug_strength = if_else(is.na(drug_strength), DRUG_STRENGTH, drug_strength))
# Creating a new column 'num_strength' that keeps only numeric values from 'drug_strength'
presc$num_strength <- str_extract(presc$drug_strength, "[0-9]*.*[0-9]")
presc_raw = presc
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor"), sep = '/')
View(presc_raw)
presc_raw = presc
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor"), sep = '/')
presc_raw$divisor[which(is.na(presc_raw$divisor))] = 1
presc_raw$compound[which(is.na(presc_raw$compound))] = 1
presc_raw = presc_raw %>% mutate(opioid = if_else(opioid_strength>compound, compound, opioid_strength))
presc_raw = presc
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor"), sep = '/')
presc_raw$divisor[which(is.na(presc_raw$divisor))] = 1
#presc_raw$compound[which(is.na(presc_raw$compound))] = 1
presc_raw = presc_raw %>% mutate(opioid = if_else(opioid_strength>compound, compound, opioid_strength))
#presc_raw$compound[which(is.na(presc_raw$compound))] = 1
presc_raw = presc_raw %>% mutate(opioid = if_else(is.na(compound), opioid_strength,
if_else(opioid_strength>compound, compound, opioid_strength)))
unique(presc_raw$opioid)
unique(presc_raw$compound)
unique(presc_raw$opioid)
unique(presc_raw$opioid_strength)
unique(presc_raw$drug_strength)
View(presc)
unique(presc$num_strength)
presc_raw = presc
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, opioid_strength, c("opioid", "divisor"), sep = '/')
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor2"), sep = '/')
unique(presc_raw$opioid)
unique(presc_raw$compound)
unique(presc_raw$divisor)
unique(presc_raw$divisor2)
length(presc_raw$divisor)
length(!is.na(presc_raw$divisor))
sum(presc_raw$divisor==presc_raw$divisor2)
sum(presc_raw$divisor==presc_raw$divisor2,na.rm=TRUE)
presc_raw = presc_raw %>% mutate(divisor = if_else(is.na(divisor), divisor2, divisor))
unique(presc_raw$divisor)
rm(divisor2)
presc_raw = presc_raw %>% select(-divisor2)
presc_raw = presc_raw %>% mutate(opioid = if_else(is.na(compound), opioid,
if_else(opioid>compound, compound, opioid)))
grepl("30-1.2", presc_raw$drug_strength)
presc_raw[which(grepl("30-1.2", presc_raw$drug_strength))]
presc_raw[which(grepl("30-1.2", presc_raw$drug_strength)),]
presc_raw[which(grepl("30-1.2", presc_raw$drug_strength)),]
grepl("30-1.2", presc_raw$drug_strength)
presc_raw[grepl("30-1.2", presc_raw$drug_strength),]
presc_raw[grepl("30-1.2", presc_raw$drug_strength),]
presc_raw[grepl("30-1.2", presc_raw$drug_strength)]
presc_raw[1117825,]
presc_raw$divisor[which(is.na(presc_raw$divisor))] = 1
presc_raw$divisor[which(is.na(presc_raw$divisor))] = 1
presc_raw$compound[which(is.na(presc_raw$compound))] = 1
presc_raw = presc_raw %>% mutate(opioid_converted = opioid/divisor)
presc_raw = presc_raw %>% mutate(opioid_converted = as.numeric(opioid)/as.numeric(divisor))
unique(presc_raw$opioid_converted)
presc_raw = presc
#--- Loading helper files
loadlibs = function(libs) {
for(lib in libs) {
class(lib)
if(!do.call(require,as.list(lib))) {install.packages(lib)}
do.call(require,as.list(lib))
}
}
libs = c("tidyr","magrittr","purrr","dplyr","stringr","readr","data.table", "mice",
"randomForest", "ada", "gbm", "caret", "e1071", "ROCR", "ggplot2", "glmnet", "readxl")
loadlibs(libs)
mode_fun <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
#--- setting global decimal print setting
options(scipen=4)
prog = fread("program_activity.csv") %>% as_tibble()
dem = fread("demographic.csv") %>% as_tibble()
presc = fread("opiate_prescription_fills.csv") %>% as_tibble()
summary(dem %>% mutate_if(is.character, as.factor))
# missing data for RACE and GENDER
# merging native hawaiian/pacific islander + no data = no data and other because the former is too small
# merging transgendered male to female and no data = no data and other because former is too small
# dealing with missingness by allowing it to be its own category - because most likely MNAR
dem$RACE[which(grepl("No Data", dem$RACE))] = "No Data and Other"
dem$RACE[which(grepl("Native Hawaiian", dem$RACE))] = "No Data and Other"
dem$GENDER[which(grepl("No Data", dem$GENDER))] = "No Data and Other"
dem$GENDER[which(grepl("Transgendered", dem$GENDER))] = "No Data and Other"
colnames(dem) = c("PERSON_ID", "race", "gender")
summary(dem %>% mutate_if(is.character, as.factor))
summary(prog)
# No missing values in the program data
# Overdose date and opiate overdose has NAs for individuals who have not overdosed,
# so that is meaningful and not actually missing
prog = prog %>% separate(OVERDOSE_DATE, c("OVERDOSE_YEAR", "OVERDOSE_MONTH"), remove=FALSE, sep=4)
prog$OPIATE_OVERDOSE[which(grepl(0, prog$OPIATE_OVERDOSE))] = "Non-Opiate Overdose"
prog$OPIATE_OVERDOSE[which(grepl(1, prog$OPIATE_OVERDOSE))] = "Opiate Overdose"
prog$OPIATE_OVERDOSE[which(is.na(prog$OPIATE_OVERDOSE))] = "No Overdose"
summary(prog %>% mutate_if(is.character, as.factor))
times_used = prog %>% group_by(PERSON_ID) %>% select(YEAR, MONTH) %>% summarise(times_used = max(sequence(n())))
prog_summary = prog %>% group_by(PERSON_ID) %>% summarise(total_cyfchild = sum(CYFCHILD),
total_cyfparent = sum(CYFPARENT),
total_mh = sum(MH),
total_da = sum(DA),
total_rx = sum(RX),
total_acj = sum(ACJ),
total_cr_cases = sum(MDJS_CR_CASES),
total_cr_drug_cases = sum(MDJS_CR_DRUG_CASES))
outcome_df = prog %>% group_by(PERSON_ID) %>%
summarise(od_date = max(OVERDOSE_DATE), od_year = max(OVERDOSE_YEAR),
od_month = max(OVERDOSE_MONTH), od_type = max(OPIATE_OVERDOSE))
summary(presc %>% mutate_if(is.character, as.factor))
age_df = presc %>% group_by(PERSON_ID) %>% summarise(min_age = min(AGE), max_age = max(AGE), mean_age = mean(AGE))
age_df = age_df %>% group_by(PERSON_ID) %>% mutate(age = if_else(min_age<0, max_age, min_age)) %>%
mutate(age = if_else(age<0, 999, age))
age_df$age[which(age_df$age>99)] = NA
summary(age_df)
presc_raw = presc
View(presc_raw)
presc_raw$drug_strength <- str_extract(presc_raw$LABEL_NAME, "[0-9].*")
# drug strength indicated that these are oral solutions per 5ML, so made this change manually
presc_raw$drug_strength[which(grepl('ORAL SOLUTION', presc_raw$extract_strength))] <- "5-325/5ML"
presc_raw$drug_strength[which(grepl('NALOXONE', presc_raw$LABEL_NAME))] <- "50MG-0.5MG"
presc_raw = presc_raw %>% mutate(drug_strength = if_else(is.na(drug_strength), DRUG_STRENGTH, drug_strength))
unique(presc_raw$drug_strength)
# Creating a new column 'num_strength' that keeps only numeric values from 'drug_strength'
presc_raw$num_strength <- str_extract(presc_raw$drug_strength, "[0-9]*.*[0-9]")
unique(presc_raw$drug_strength)
unique(presc_raw$num_strength)
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, opioid_strength, c("opioid", "divisor"), sep = '/')
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor2"), sep = '/')
unique(presc_raw$opioid)
unique(presc_raw$compound)
presc_raw$opioid <- str_extract(presc_raw$opioid, "[0-9].*")
unique(presc_raw$opioid)
presc_raw$opioid <- str_extract(presc_raw$opioid, "[0-9]*.*[0-9]")
unique(presc_raw$opioid)
presc_raw = presc
presc_raw$drug_strength <- str_extract(presc_raw$LABEL_NAME, "[0-9].*")
# drug strength indicated that these are oral solutions per 5ML, so made this change manually
presc_raw$drug_strength[which(grepl('ORAL SOLUTION', presc_raw$extract_strength))] <- "5-325/5ML"
presc_raw$drug_strength[which(grepl('NALOXONE', presc_raw$LABEL_NAME))] <- "50MG-0.5MG"
presc_raw = presc_raw %>% mutate(drug_strength = if_else(is.na(drug_strength), DRUG_STRENGTH, drug_strength))
# Creating a new column 'num_strength' that keeps only numeric values from 'drug_strength'
presc_raw$num_strength <- str_extract(presc_raw$drug_strength, "[0-9]*.*[0-9]")
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, opioid_strength, c("opioid", "divisor"), sep = '/')
presc_raw$opioid <- str_extract(presc_raw$opioid, "[0-9]*.*[0-9]")
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor2"), sep = '/')
#sum(presc_raw$divisor==presc_raw$divisor2,na.rm=TRUE)
presc_raw = presc_raw %>% mutate(divisor = if_else(is.na(divisor), divisor2, divisor))
presc_raw = presc_raw %>% select(-divisor2)
presc_raw = presc_raw %>% mutate(opioid = if_else(is.na(compound), opioid,
if_else(opioid>compound, compound, opioid)))
presc_raw$divisor[which(is.na(presc_raw$divisor))] = 1
presc_raw$compound[which(is.na(presc_raw$compound))] = 1
presc_raw = presc_raw %>% mutate(opioid_converted = as.numeric(opioid)/as.numeric(divisor))
presc_raw = presc
presc_raw$drug_strength <- str_extract(presc_raw$LABEL_NAME, "[0-9].*")
# drug strength indicated that these are oral solutions per 5ML, so made this change manually
presc_raw$drug_strength[which(grepl('ORAL SOLUTION', presc_raw$extract_strength))] <- "5-325/5ML"
presc_raw$drug_strength[which(grepl('NALOXONE', presc_raw$LABEL_NAME))] <- "50MG-0.5MG"
presc_raw = presc_raw %>% mutate(drug_strength = if_else(is.na(drug_strength), DRUG_STRENGTH, drug_strength))
# Creating a new column 'num_strength' that keeps only numeric values from 'drug_strength'
presc_raw$num_strength <- str_extract(presc_raw$drug_strength, "[0-9]*.*[0-9]")
presc_raw <- separate(presc_raw, num_strength, c("opioid_strength", "compound_strength"), sep = '-')
presc_raw <- separate(presc_raw, opioid_strength, c("opioid", "divisor"), sep = '/')
presc_raw$opioid <- str_extract(presc_raw$opioid, "[0-9]*.*[0-9]")
presc_raw <- separate(presc_raw, compound_strength, c("compound", "divisor2"), sep = '/')
#sum(presc_raw$divisor==presc_raw$divisor2,na.rm=TRUE)
presc_raw = presc_raw %>% mutate(divisor = if_else(is.na(divisor), divisor2, divisor))
presc_raw = presc_raw %>% select(-divisor2)
presc_raw = presc_raw %>% mutate(opioid = if_else(is.na(compound), opioid,
if_else(opioid>compound, compound, opioid)))
presc_raw$divisor[which(is.na(presc_raw$divisor))] = 1
presc_raw$compound[which(is.na(presc_raw$compound))] = 1
presc_raw = presc_raw %>% mutate(opioid_converted = as.numeric(opioid)/as.numeric(divisor))
unique(presc_raw$opioid_converted)
unique(presc_raw$DOSAGE_FORM_DESC)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('TABLET', DOSAGE_FORM_DESC) & grepl('MG', drug_strength),
30, NA))
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('TABLET', DOSAGE_FORM_DESC) & grepl('MG', drug_strength),
30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('TABLET', DOSAGE_FORM_DESC),
30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME) & grepl('TABLET', presc_raw$DOSAGE_FORM_DESC),
30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME), 30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME), 30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else('BUPRENORPHINE'%in% GENERIC_NAME), 30, 0)
if_else('BUPRENORPHINE'%in% GENERIC_NAME, 30, 0)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else('BUPRENORPHINE'%in% GENERIC_NAME, 30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else('BUPRENORPHINE'%in% GENERIC_NAME & 'TABLET' %in% DOSAGE_FORM_DESC, 30, 0))
unique(presc_raw$conversion_factor)
presc_raw = presc_raw %>%
mutate(conversion_factor =
if_else(which('BUPRENORPHINE'%in% GENERIC_NAME & 'TABLET' %in% DOSAGE_FORM_DESC), 30, 0))
'BUPRENORPHINE'%in% presc_raw$GENERIC_NAME
which('BUPRENORPHINE'%in% presc_raw$GENERIC_NAME)
presc_raw$which('BUPRENORPHINE'%in% presc_raw$GENERIC_NAME)
presc_raw[which('BUPRENORPHINE'%in% presc_raw$GENERIC_NAME)]
presc_raw[which('BUPRENORPHINE'%in% presc_raw$GENERIC_NAME),]
grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME)
sum(grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME))
sum(grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME) & grepl('TABLET', presc_raw$DOSAGE_FORM_DESC))
sum(grepl('TABLET', presc_raw$DOSAGE_FORM_DESC))
presc_raw[grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME)]
presc_raw[grepl('BUPRENORPHINE', presc_raw$GENERIC_NAME),]
presc_raw <- presc_raw %>%
mutate(conversion_factor =
if_else(GENERIC_NAME == 'BUPRENORPHINE' & DOSAGE_FORM_DESC == 'PATCH, TRANSDERMAL WEEKLY', 12.6,
if_else(GENERIC_NAME == 'BUPRENORPHINE HCL' & DOSAGE_FORM_DESC == 'AMPUL (ML)', 30,
if_else(GENERIC_NAME == 'BUTORPHANOL TARTRATE' & DOSAGE_FORM_DESC == 'AEROSOL, SPRAY (ML)', 7,
if_else(GENERIC_NAME == 'CODEINE PHOSPHATE/CARI', 0.15,
if_else(GENERIC_NAME == 'CODEINE SULFATE', 0.15,
if_else(GENERIC_NAME == 'DIHYDROCODEINE BITARTRATE', 0.25,
if_else(GENERIC_NAME == 'FENTANYL', 7.2,
if_else(GENERIC_NAME == 'FENTANYL CITRATE', 0.13,
if_else(GENERIC_NAME == 'HYDROCODONE BITARTRATE', 1,
if_else(GENERIC_NAME == 'HYDROMORPHONE HCL', 4,
if_else(GENERIC_NAME == 'LEVORPHANOL TARTRATE', 11,
if_else(GENERIC_NAME == 'MEPERIDINE HCL', 0.1,
if_else(GENERIC_NAME == 'METHADONE HCL', 3,
if_else(GENERIC_NAME == 'MORPHINE SULFATE', 1,
if_else(GENERIC_NAME == 'OXYCODONE HCL', 1.5,
if_else(GENERIC_NAME == 'OXYMORPHONE HCL', 3,
if_else(GENERIC_NAME == 'PENTAZOCINE HCL', 0.37,
if_else(GENERIC_NAME == 'TAPENTADOL HCL', 0.4,
if_else(GENERIC_NAME == 'TRAMADOL HCL', 0.1, 0))))))))))))))))))))
unique(presc_raw$conversion_factor)
summary(presc_raw$conversion_factor)
table(presc_raw$conversion_factor)
presc_raw %>% filter(conversion_factor == 0)
presc_raw %>% filter(grepl('METHADONE', GENERIC_NAME))
df = presc_raw %>% filter(grepl('METHADONE', GENERIC_NAME))
table(df$DRUG_STRENGTH)
table(df$DRUG_STRENGTH, df$DOSAGE_FORM_DESC)
table(df$opioid_converted, df$DOSAGE_FORM_DESC)
presc_raw <- presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('PATCH', DOSAGE_FORM_DESC), 12.6,
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('AMPUL', DOSAGE_FORM_DESC), 30,
if_else(grepl('BUTORPHANOL TARTRATE', GENERIC_NAME) & grepl('SPRAY', DOSAGE_FORM_DESC), 7,
if_else(grepl('CODEINE', GENERIC_NAME), 0.15,
if_else(grepl('DIHYDROCODEINE BITARTRATE', GENERIC_NAME), 0.25,
if_else(grepl('FENTANYL', GENERIC_NAME), 7.2,
if_else(grepl('FENTANYL CITRATE', GENERIC_NAME), 0.13,
if_else(grepl('HYDROCODONE BITARTRATE', GENERIC_NAME), 1,
if_else(grepl('HYDROMORPHONE', GENERIC_NAME), 4,
if_else(grepl('LEVORPHANOL TARTRATE', GENERIC_NAME), 11,
if_else(grepl('MEPERIDINE', GENERIC_NAME), 0.1,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted<=20, 4,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted>20, 8,
if_else(grepl('MORPHINE', GENERIC_NAME), 1,
if_else(grepl('OXYCODONE', GENERIC_NAME), 1.5,
if_else(grepl('OXYMORPHONE', GENERIC_NAME), 3,
if_else(grepl('PENTAZOCINE', GENERIC_NAME), 0.37,
if_else(grepl('TAPENTADOL', GENERIC_NAME), 0.4,
if_else(grepl('TRAMADOL', GENERIC_NAME), 0.1, 0))))))))))))))))))))
unique(presc_raw$conversion_factor)
table(presc_raw$conversion_factor)
presc_raw %>% filter(conversion_factor == 0)
presc_raw <- presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('PATCH', DOSAGE_FORM_DESC), 12.6,
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('AMPUL', DOSAGE_FORM_DESC), 30,
if_else(grepl('BUTORPHANOL TARTRATE', GENERIC_NAME) & grepl('SPRAY', DOSAGE_FORM_DESC), 7,
if_else(grepl('CODEINE', GENERIC_NAME), 0.15,
if_else(grepl('DIHYDROCODEINE BITARTRATE', GENERIC_NAME), 0.25,
if_else(grepl('FENTANYL', GENERIC_NAME), 7.2,
if_else(grepl('FENTANYL CITRATE', GENERIC_NAME), 0.13,
if_else(grepl('HYDROCODONE', GENERIC_NAME), 1,
if_else(grepl('HYDROMORPHONE', GENERIC_NAME), 4,
if_else(grepl('LEVORPHANOL TARTRATE', GENERIC_NAME), 11,
if_else(grepl('MEPERIDINE', GENERIC_NAME), 0.1,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted<=20, 4,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted>20, 8,
if_else(grepl('MORPHINE', GENERIC_NAME), 1,
if_else(grepl('OXYCODONE', GENERIC_NAME), 1.5,
if_else(grepl('OXYMORPHONE', GENERIC_NAME), 3,
if_else(grepl('PENTAZOCINE', GENERIC_NAME), 0.37,
if_else(grepl('TAPENTADOL', GENERIC_NAME), 0.4,
if_else(grepl('TRAMADOL', GENERIC_NAME), 0.1, 0))))))))))))))))))))
table(presc_raw$conversion_factor)
presc_raw %>% filter(conversion_factor == 0)
presc_raw <- presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('PATCH', DOSAGE_FORM_DESC), 12.6,
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('AMPUL', DOSAGE_FORM_DESC), 30,
if_else(grepl('BUTORPHANOL TARTRATE', GENERIC_NAME) & grepl('SPRAY', DOSAGE_FORM_DESC), 7,
if_else(grepl('CODEINE', GENERIC_NAME), 0.15,
if_else(grepl('DIHYDROCODEINE BITARTRATE', GENERIC_NAME), 0.25,
if_else(grepl('OPIUM', GENERIC_NAME), 1,
if_else(grepl('FENTANYL', GENERIC_NAME), 7.2,
if_else(grepl('FENTANYL CITRATE', GENERIC_NAME), 0.13,
if_else(grepl('HYDROCODONE', GENERIC_NAME), 1,
if_else(grepl('HYDROMORPHONE', GENERIC_NAME), 4,
if_else(grepl('LEVORPHANOL TARTRATE', GENERIC_NAME), 11,
if_else(grepl('MEPERIDINE', GENERIC_NAME), 0.1,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted<=20, 4,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted>20, 8,
if_else(grepl('MORPHINE', GENERIC_NAME), 1,
if_else(grepl('OXYCODONE', GENERIC_NAME), 1.5,
if_else(grepl('OXYMORPHONE', GENERIC_NAME), 3,
if_else(grepl('PENTAZOCINE', GENERIC_NAME), 0.37,
if_else(grepl('TAPENTADOL', GENERIC_NAME), 0.4,
if_else(grepl('TRAMADOL', GENERIC_NAME), 0.1, 0)))))))))))))))))))))
table(presc_raw$conversion_factor)
presc_raw %>% filter(conversion_factor == 0)
df = presc_raw %>% filter(grepl('BUPRENORPHINE', GENERIC_NAME))
table(df$opioid_converted, df$DOSAGE_FORM_DESC)
table(df$conversion_factor, df$DOSAGE_FORM_DESC)
table(df$conversion_factor, df$DRUG_STRENGTH)
df = presc_raw %>% filter(grepl('FENTANYL', GENERIC_NAME))
table(df$conversion_factor, df$DRUG_STRENGTH)
table(df$conversion_factor, df$DOSAGE_FORM_DESC)
presc_raw <- presc_raw %>%
mutate(conversion_factor =
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('PATCH', DOSAGE_FORM_DESC), 12.6,
if_else(grepl('BUPRENORPHINE', GENERIC_NAME) & grepl('AMPUL', DOSAGE_FORM_DESC), 30,
if_else(grepl('BUTORPHANOL', GENERIC_NAME), 7,
if_else(grepl('CODEINE', GENERIC_NAME), 0.15,
if_else(grepl('DIHYDROCODEINE BITARTRATE', GENERIC_NAME), 0.25,
if_else(grepl('OPIUM', GENERIC_NAME), 1,
if_else(grepl('FENTANYL', GENERIC_NAME) & grepl('TABLET', DOSAGE_FORM_DESC), 0.13,
if_else(grepl('FENTANYL', GENERIC_NAME) & grepl('LOZENGE', DOSAGE_FORM_DESC), 0.13,
if_else(grepl('FENTANYL', GENERIC_NAME) & grepl('PATCH', DOSAGE_FORM_DESC), 7.2,
if_else(grepl('NALBUPHINE', GENERIC_NAME), 1,
if_else(grepl('FENTANYL CITRATE', GENERIC_NAME), 0.13,
if_else(grepl('HYDROCODONE', GENERIC_NAME), 1,
if_else(grepl('HYDROMORPHONE', GENERIC_NAME), 4,
if_else(grepl('LEVORPHANOL TARTRATE', GENERIC_NAME), 11,
if_else(grepl('MEPERIDINE', GENERIC_NAME), 0.1,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted<=20, 4,
if_else(grepl('METHADONE', GENERIC_NAME) & opioid_converted>20, 8,
if_else(grepl('MORPHINE', GENERIC_NAME), 1,
if_else(grepl('OXYCODONE', GENERIC_NAME), 1.5,
if_else(grepl('OXYMORPHONE', GENERIC_NAME), 3,
if_else(grepl('PENTAZOCINE', GENERIC_NAME), 0.37,
if_else(grepl('TAPENTADOL', GENERIC_NAME), 0.4,
if_else(grepl('TRAMADOL', GENERIC_NAME), 0.1, 0))))))))))))))))))))))))
unique(presc_raw$conversion_factor)
presc_raw$MME <- round(presc_raw$opioid_converted*presc_raw$DISPENSED_QTY*presc_raw$conversion_factor,2)
unique(presc_raw$MME)
presc_raw[which(grepl('MCG/HR', presc_raw$extract_strength))]
presc_raw[which(grepl('MCG/HR', presc_raw$drug_strength))]
presc_raw[which(grepl('MCG/HR', presc_raw$drug_strength)),]
df = presc_raw %>% filter(grepl('PATCH', presc_raw$DOSAGE_FORM_DESC))
table(df$DOSAGE_FORM_DESC, df$GENERIC_NAME)
View(df)
presc_raw$MME <- round((presc_raw$opioid_converted*presc_raw$DISPENSED_QTY*presc_raw$conversion_factor)/presc_raw$DAYS_SUPPLY,2)
table(presc_raw$MME)
unique(presc_raw$MME)
